<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nanxi Topup Center - Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;700&display=swap" rel="stylesheet" />
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
  <style>
    body {
      font-family: 'Kanit', sans-serif;
    }

    .glow {
      box-shadow: 0 0 10px #3b82f6, 0 0 20px #3b82f6, 0 0 30px #3b82f6;
    }

    .fade-in {
      animation: fadeIn 0.6s ease-in-out both;
    }

    @keyframes fadeIn {
      0% {
        opacity: 0;
        transform: translateY(10px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">

  <header class="bg-white dark:bg-gray-800 shadow-md">
    <nav class="container mx-auto px-6 py-4">
      <h1 class="text-2xl font-bold text-blue-600 dark:text-blue-400 glow">Admin Panel - Nanxi Topup Center</h1>
    </nav>
  </header>

  <main class="container mx-auto px-6 py-8">
    <h2 class="text-3xl font-bold mb-6" data-aos="fade-right">Latest Orders</h2>

    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-x-auto" data-aos="zoom-in">
      <table class="w-full text-left">
        <thead class="bg-gray-50 dark:bg-gray-700">
          <tr>
            <th class="p-4 font-bold">Order Time</th>
            <th class="p-4 font-bold">Game Name</th>
            <th class="p-4 font-bold">Player ID</th>
            <th class="p-4 font-bold">Package</th>
            <th class="p-4 font-bold">Price</th>
            <th class="p-4 font-bold">Status</th>
            <th class="p-4 font-bold">Action</th>
          </tr>
        </thead>
        <tbody id="orders-table-body">
          <tr>
            <td colspan="7" class="text-center p-8 text-gray-500">Loading data...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      onSnapshot,
      doc,
      updateDoc,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAkXOGTHHHn9HOFpCypGhbVEi9IDRW6hfw",
      authDomain: "mygame-topup-shop.firebaseapp.com",
      projectId: "mygame-topup-shop",
      storageBucket: "mygame-topup-shop.firebasestorage.app",
      messagingSenderId: "878663003843",
      appId: "1:878663003843:web:38c5b8cc8a030f01ab3c76"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const ordersTableBody = document.getElementById("orders-table-body");
    const q = query(collection(db, "orders"), orderBy("createdAt", "desc"));

    onSnapshot(q, (querySnapshot) => {
      ordersTableBody.innerHTML = "";

      if (querySnapshot.empty) {
        ordersTableBody.innerHTML =
          '<tr><td colspan="7" class="text-center p-8 text-gray-500">No orders yet</td></tr>';
        return;
      }

      querySnapshot.forEach((docSnap) => {
        const order = docSnap.data();
        const orderId = docSnap.id;
        const row = document.createElement("tr");
        row.className = "border-b dark:border-gray-700 fade-in";

        const orderDate = order.createdAt
          ? new Date(order.createdAt.seconds * 1000).toLocaleString("en-US")
          : "N/A";

        const statusColor =
          order.status === "completed"
            ? "text-green-500"
            : "text-yellow-500";
        const statusText =
          order.status === "completed" ? "Completed" : "Pending";

        row.innerHTML = `
          <td class="p-4">${orderDate}</td>
          <td class="p-4">${order.gameName}</td>
          <td class="p-4">${order.playerId}</td>
          <td class="p-4">${order.packageName}</td>
          <td class="p-4">${order.price}</td>
          <td class="p-4 font-bold ${statusColor}">${statusText}</td>
          <td class="p-4">
            ${
              order.status === "pending"
                ? `<button data-id="${orderId}" class="update-status-btn glow bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md">Mark as Completed</button>`
                : ""
            }
          </td>
        `;
        ordersTableBody.appendChild(row);
      });

      document.querySelectorAll(".update-status-btn").forEach((button) => {
        button.addEventListener("click", async (e) => {
          const docId = e.target.dataset.id;
          const orderDocRef = doc(db, "orders", docId);
          e.target.textContent = "Updating...";
          e.target.disabled = true;

          try {
            await updateDoc(orderDocRef, {
              status: "completed"
            });
          } catch (error) {
            console.error("Error updating status: ", error);
            alert("Error updating order status");
          }
        });
      });
    });
  </script>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init();
  </script>
</body>

</html>
